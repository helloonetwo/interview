# ä¼˜åŒ–æ„å»ºç»“æœ

## 2.1 æ„å»ºç»“æœåˆ†æ
å€ŸåŠ©æ’ä»¶ [webpack-bundle-analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer)æˆ‘ä»¬å¯ä»¥ç›´è§‚çš„çœ‹åˆ°æ‰“åŒ…ç»“æœä¸­ï¼Œæ–‡ä»¶çš„ä½“ç§¯å¤§å°ã€å„æ¨¡å—ä¾èµ–å…³ç³»ã€æ–‡ä»¶æ˜¯å¤Ÿé‡å¤ç­‰é—®é¢˜ï¼Œæå¤§çš„æ–¹ä¾¿æˆ‘ä»¬åœ¨è¿›è¡Œé¡¹ç›®ä¼˜åŒ–çš„æ—¶å€™ï¼Œè¿›è¡Œé—®é¢˜è¯Šæ–­ã€‚

- å®‰è£…
```bash
$ npm i -D webpack-bundle-analyzer
```

- é…ç½®æ’ä»¶
```js
// å¼•å…¥æ’ä»¶
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin


const config = {
  // ...
  plugins:[ 
    // ...
    // é…ç½®æ’ä»¶ 
    new BundleAnalyzerPlugin({
      // analyzerMode: 'disabled',  // ä¸å¯åŠ¨å±•ç¤ºæ‰“åŒ…æŠ¥å‘Šçš„httpæœåŠ¡å™¨
      // generateStatsFile: true, // æ˜¯å¦ç”Ÿæˆstats.jsonæ–‡ä»¶
    })
  ],
};
```

- ä¿®æ”¹å¯åŠ¨å‘½ä»¤
```json
 "scripts": {
    // ...
    "analyzer": "cross-env NODE_ENV=prod webpack --progress --mode production"
  },
```

æ‰§è¡Œç¼–è¯‘å‘½ä»¤ npm run analyzer

æ‰“åŒ…ç»“æŸåï¼Œä¼šè‡ªè¡Œå¯åŠ¨åœ°å€ä¸º http://127.0.0.1:8888 çš„ web æœåŠ¡ï¼Œè®¿é—®åœ°å€å°±å¯ä»¥çœ‹åˆ°

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee392f0838bd43e5aeeb405c76f2fbc7~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)


å¦‚æœï¼Œæˆ‘ä»¬åªæƒ³ä¿ç•™æ•°æ®ä¸æƒ³å¯åŠ¨ web æœåŠ¡ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸Šä¸¤ä¸ªé…ç½®
```js
new BundleAnalyzerPlugin({
   analyzerMode: 'disabled',  // ä¸å¯åŠ¨å±•ç¤ºæ‰“åŒ…æŠ¥å‘Šçš„httpæœåŠ¡å™¨
   generateStatsFile: true, // æ˜¯å¦ç”Ÿæˆstats.jsonæ–‡ä»¶
})
```
è¿™æ ·å†æ¬¡æ‰§è¡Œæ‰“åŒ…çš„æ—¶å€™å°±åªä¼šäº§ç”Ÿ state.json çš„æ–‡ä»¶äº†


## 2.2 å‹ç¼© CSS

- å®‰è£… optimize-css-assets-webpack-plugin
```js
$ npm install -D optimize-css-assets-webpack-plugin 

```
- ä¿®æ”¹ webapck.config.js é…ç½®

```js
// å‹ç¼©css
const OptimizeCssAssetsPlugin = require('optimize-css-assets-webpack-plugin')
// ...

const config = {
  // ...
  optimization: {
    minimize: true,
    minimizer: [
      // æ·»åŠ  css å‹ç¼©é…ç½®
      new OptimizeCssAssetsPlugin({}),
    ]
  },
 // ...
}

// ...

```
- æŸ¥çœ‹æ‰“åŒ…ç»“æœ
![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2b3174e204994b2e9c845f5bbc144577~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)




## 2.3 å‹ç¼© JS

åœ¨ç”Ÿæˆç¯å¢ƒä¸‹æ‰“åŒ…é»˜è®¤ä¼šå¼€å¯ js å‹ç¼©ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æ‰‹åŠ¨é…ç½® optimization é€‰é¡¹ä¹‹åï¼Œå°±ä¸å†é»˜è®¤å¯¹ js è¿›è¡Œå‹ç¼©ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»é…ç½®ã€‚

> å› ä¸º webpack5 å†…ç½®äº†terser-webpack-plugin æ’ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€é‡å¤å®‰è£…ï¼Œç›´æ¥å¼•ç”¨å°±å¯ä»¥äº†ï¼Œå…·ä½“é…ç½®å¦‚ä¸‹
```js
const TerserPlugin = require('terser-webpack-plugin');

const config = {
  // ...
  optimization: {
    minimize: true, // å¼€å¯æœ€å°åŒ–
    minimizer: [
      // ...
      new TerserPlugin({})
    ]
  },
  // ...
}
```


## 2.4 æ¸…é™¤æ— ç”¨çš„ CSS
[purgecss-webpack-plugin](https://www.purgecss.cn/plugins/webpack.html#%E7%94%A8%E6%B3%95) ä¼šå•ç‹¬æå– CSS å¹¶æ¸…é™¤ç”¨ä¸åˆ°çš„ CSS

- å®‰è£…æ’ä»¶
```
$ npm i -D purgecss-webpack-plugin
```

- æ·»åŠ é…ç½®
```js
// ...
const { PurgeCSSPlugin } = require('purgecss-webpack-plugin')
const glob = require('glob'); // æ–‡ä»¶åŒ¹é…æ¨¡å¼
// ...

function resolve(dir){
  return path.join(__dirname, dir);
}

const PATHS = {
  src: resolve('src')
}

const config = {
  plugins:[ // é…ç½®æ’ä»¶
    // ...
    new PurgeCSSPlugin({
      paths: glob.sync(`${PATHS.src}/**/*`, {nodir: true})
    }),
  ]
}
```


- index.html æ–°å¢èŠ‚ç‚¹
```html
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ITEM</title>
</head>
<body>
  <p></p>
  <!-- ä½¿ç”¨å­—ä½“å›¾æ ‡æ–‡ä»¶ -->
  <i class="iconfont icon-member"></i>
  <div id="imgBox"></div>
  
   <!-- æ–°å¢ divï¼Œè®¾ç½® class ä¸º used -->
  <div class="used"></div>
</body>
</html>

```

- åœ¨ sass.scss ä¸­æ·»åŠ æ ·å¼
```css
.used {
  width: 200px;
  height: 200px;
  background: #ccc;
}

.unused {
  background: chocolate;
}

```
- æ‰§è¡Œä¸€ä¸‹æ‰“åŒ…
![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ca0ac6b477146ad82d6b1332ae626a6~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åªæœ‰ .used è¢«ä¿å­˜ä¸‹æ¥
å¦‚ä½•è¯æ˜æ˜¯è¿™ä¸ªæ’ä»¶çš„ä½œç”¨å‘¢ï¼Ÿæ³¨é‡Šæ‰å†æ‰“åŒ…å°±å¯ä»¥çœ‹åˆ°ï¼Œ.unused ä¹Ÿä¼šè¢«æ‰“åŒ…è¿›å»ï¼Œç”±æ­¤å¯è¯...


## 2.5 Tree-shaking
Tree-shaking ä½œç”¨æ˜¯å‰”é™¤æ²¡æœ‰ä½¿ç”¨çš„ä»£ç ï¼Œä»¥é™ä½åŒ…çš„ä½“ç§¯

> webpack é»˜è®¤æ”¯æŒï¼Œéœ€è¦åœ¨ .bablerc é‡Œé¢è®¾ç½® modelï¼šfalseï¼Œå³å¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹é»˜è®¤å¼€å¯

äº†è§£æ›´å¤š Tree-shaking çŸ¥è¯†ï¼Œæ¨èé˜…è¯» ğŸ‘‰ğŸ» [ä»è¿‡å»åˆ°ç°åœ¨ï¼ŒèŠèŠ Tree-shaking](https://mp.weixin.qq.com/s/TNXO2ifPymaTxIqzBAmkSQ)
```js
module.exports = {
  presets: [
    [
      "@babel/preset-env",
      {
        module: false,
        useBuiltIns: "entry",
        corejs: "3.9.1",
        targets: {
          chrome: "58",
          ie: "11",
        },
      },
    ],
  ],
  plugins: [    
    ["@babel/plugin-proposal-decorators", { legacy: true }],
    ["@babel/plugin-proposal-class-properties", { loose: true }],
  ]
};
```


## 2.6 Scope Hoisting
Scope Hoisting å³ä½œç”¨åŸŸæå‡ï¼ŒåŸç†æ˜¯å°†å¤šä¸ªæ¨¡å—æ”¾åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸä¸‹ï¼Œå¹¶é‡å‘½åé˜²æ­¢å‘½åå†²çªï¼Œé€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥å‡å°‘å‡½æ•°å£°æ˜å’Œå†…å­˜å¼€é”€ã€‚

- webpack é»˜è®¤æ”¯æŒï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹é»˜è®¤å¼€å¯
- åªæ”¯æŒ es6 ä»£ç 

