# ä¼˜åŒ–æ„å»ºé€Ÿåº¦


## 1.1 æ„å»ºè´¹æ—¶åˆ†æ

### 1.1 æ„å»ºè´¹æ—¶åˆ†æ
è¿™é‡Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ’ä»¶ [speed-measure-webpack-plugin](https://www.npmjs.com/package/speed-measure-webpack-plugin)ï¼Œæˆ‘ä»¬å‚è€ƒæ–‡æ¡£é…ç½®ä¸€ä¸‹
é¦–å…ˆå®‰è£…ä¸€ä¸‹
```js
$ npm i -D speed-measure-webpack-plugin
```
ä¿®æ”¹æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶ webpack.config.js

```js
// è´¹æ—¶åˆ†æ
const SpeedMeasurePlugin = require("speed-measure-webpack-plugin");
const smp = new SpeedMeasurePlugin();
...

const config = {...}

module.exports = (env, argv) => {
  // è¿™é‡Œå¯ä»¥é€šè¿‡ä¸åŒçš„æ¨¡å¼ä¿®æ”¹ config é…ç½®


  return smp.wrap(config);
}

```
æ‰§è¡Œæ‰“åŒ…
![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae510d710d494d22a00378d8d52753d2~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

æŠ¥é”™äº†ğŸ¤¦ğŸ»â€â™‚ï¸ è¿™é‡Œå°±æš´éœ²äº†ä½¿ç”¨è¿™ä¸ªæ’ä»¶çš„ä¸€ä¸ªå¼Šç«¯ï¼Œå°±æ˜¯ï¼š

> æœ‰äº› Loader æˆ–è€… Plugin æ–°ç‰ˆæœ¬ä¼šä¸å…¼å®¹ï¼Œéœ€è¦è¿›è¡Œé™çº§å¤„ç†

è¿™é‡Œæˆ‘ä»¬å¯¹ mini-css-extract-plugin è¿›è¡Œä¸€ä¸‹é™çº§å¤„ç†: ^2.1.0 -> ^1.3.6

é‡æ–°å®‰è£…ä¸€ä¸‹ä¾èµ–ï¼Œå†æ¬¡æ‰§è¡Œæ‰“åŒ…
![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e369fd6b2994270971fd87291e694f6~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)

é™äº†ç‰ˆæœ¬ä¹‹åï¼Œè¿˜æ˜¯æŠ¥é”™ï¼Œæ ¹æ®æç¤ºä¿¡æ¯ï¼Œæˆ‘ä»¬ç»™é…ç½®åŠ ä¸Š publicPath: './'\

```js
output: {
    filename: 'bundle.js', // è¾“å‡ºæ–‡ä»¶å
    path: path.join(__dirname, 'dist'), // è¾“å‡ºæ–‡ä»¶ç›®å½•
    publicPath: './'
  },

```
åœ¨å°è¯•ä¸€æ¬¡ æˆåŠŸäº†ï¼
![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8abe8e0dfeb94ffe94adce229d04d0e3~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?)


> æ³¨æ„ï¼šåœ¨ webpack5.x ä¸­ä¸ºäº†ä½¿ç”¨è´¹æ—¶åˆ†æå»å¯¹æ’ä»¶è¿›è¡Œé™çº§æˆ–è€…ä¿®æ”¹é…ç½®å†™æ³•æ˜¯éå¸¸ä¸åˆ’ç®—çš„ï¼Œè¿™é‡Œå› ä¸ºæ¼”ç¤ºéœ€è¦ï¼Œæˆ‘åé¢ä¼šç»§ç»­ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨å¹³æ—¶å¼€å‘ä¸­ï¼Œå»ºè®®è¿˜æ˜¯ä¸è¦ä½¿ç”¨ã€‚



## 1.2 ä¼˜åŒ– resolve é…ç½®

### 1.2.1 alias
alias ç”¨çš„åˆ›å»º import æˆ– require çš„åˆ«åï¼Œç”¨æ¥ç®€åŒ–æ¨¡å—å¼•ç”¨ï¼Œé¡¹ç›®ä¸­åŸºæœ¬éƒ½éœ€è¦è¿›è¡Œé…ç½®ã€‚

```js
const path = require('path')
...
// è·¯å¾„å¤„ç†æ–¹æ³•
function resolve(dir){
  return path.join(__dirname, dir);
}

 const config  = {
  ...
  resolve:{
    // é…ç½®åˆ«å
    alias: {
      '~': resolve('src'),
      '@': resolve('src'),
      'components': resolve('src/components'),
    }
  }
};

```

é…ç½®å®Œæˆä¹‹åï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å°±å¯ä»¥

```js
// ä½¿ç”¨ src åˆ«å ~ 
import '~/fonts/iconfont.css'

// ä½¿ç”¨ src åˆ«å @ 
import '@/fonts/iconfont.css'

// ä½¿ç”¨ components åˆ«å
import footer from "components/footer";

```

### 1.2.2 extensions
webpack é»˜è®¤é…ç½®
```js
const config = {
  //...
  resolve: {
    extensions: ['.js', '.json', '.wasm'],
  },
};

```

å¦‚æœç”¨æˆ·å¼•å…¥æ¨¡å—æ—¶ä¸å¸¦æ‰©å±•åï¼Œä¾‹å¦‚
```js
import file from '../path/to/file';
```

é‚£ä¹ˆ webpack å°±ä¼šæŒ‰ç…§ extensions é…ç½®çš„æ•°ç»„ä»å·¦åˆ°å³çš„é¡ºåºå»å°è¯•è§£ææ¨¡å—

éœ€è¦æ³¨æ„çš„æ˜¯ï¼š

é«˜é¢‘æ–‡ä»¶åç¼€åæ”¾å‰é¢ï¼›
æ‰‹åŠ¨é…ç½®åï¼Œé»˜è®¤é…ç½®ä¼šè¢«è¦†ç›–

å¦‚æœæƒ³ä¿ç•™é»˜è®¤é…ç½®ï¼Œå¯ä»¥ç”¨ ... æ‰©å±•è¿ç®—ç¬¦ä»£è¡¨é»˜è®¤é…ç½®ï¼Œä¾‹å¦‚
```js
const config = {
  //...
  resolve: {
    extensions: ['.ts', '...'], 
  },
};
```


### 1.2.3 modules
å‘Šè¯‰ webpack è§£ææ¨¡å—æ—¶åº”è¯¥æœç´¢çš„ç›®å½•ï¼Œå¸¸è§é…ç½®å¦‚ä¸‹
```js
const path = require('path');

// è·¯å¾„å¤„ç†æ–¹æ³•
function resolve(dir){
  return path.join(__dirname, dir);
}

const config = {
  //...
  resolve: {
     modules: [resolve('src'), 'node_modules'],
  },
};
```
å‘Šè¯‰ webpack ä¼˜å…ˆ src ç›®å½•ä¸‹æŸ¥æ‰¾éœ€è¦è§£æçš„æ–‡ä»¶ï¼Œä¼šå¤§å¤§èŠ‚çœæŸ¥æ‰¾æ—¶é—´



### 1.2.4 resolveLoader
resolveLoader ä¸ä¸Šé¢çš„Â resolveÂ å¯¹è±¡çš„å±æ€§é›†åˆç›¸åŒï¼Œ ä½†ä»…ç”¨äºè§£æ webpack çš„Â loaderÂ åŒ…ã€‚
ä¸€èˆ¬æƒ…å†µä¸‹ä¿æŒé»˜è®¤é…ç½®å°±å¯ä»¥äº†ï¼Œä½†å¦‚æœä½ æœ‰è‡ªå®šä¹‰çš„ Loader å°±éœ€è¦é…ç½®ä¸€ä¸‹ï¼Œä¸é…å¯èƒ½ä¼šå› ä¸ºæ‰¾ä¸åˆ° loader æŠ¥é”™

ä¾‹å¦‚ï¼šæˆ‘ä»¬åœ¨ loader æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œæ”¾ç€æˆ‘ä»¬è‡ªå·±å†™çš„ loader

æˆ‘ä»¬å°±å¯ä»¥æ€ä¹ˆé…ç½®
```js
const path = require('path');

// è·¯å¾„å¤„ç†æ–¹æ³•
function resolve(dir){
  return path.join(__dirname, dir);
}

const config = {
  //...
  resolveLoader: {
    modules: ['node_modules',resolve('loader')]
  },
};
```

## 1.3 externals
externalsÂ é…ç½®é€‰é¡¹æä¾›äº†ã€Œä»è¾“å‡ºçš„ bundle ä¸­æ’é™¤ä¾èµ–ã€çš„æ–¹æ³•ã€‚æ­¤åŠŸèƒ½é€šå¸¸å¯¹Â library å¼€å‘äººå‘˜æ¥è¯´æ˜¯æœ€æœ‰ç”¨çš„ï¼Œç„¶è€Œä¹Ÿä¼šæœ‰å„ç§å„æ ·çš„åº”ç”¨ç¨‹åºç”¨åˆ°å®ƒã€‚
ä¾‹å¦‚ï¼Œä» CDN å¼•å…¥ jQueryï¼Œè€Œä¸æ˜¯æŠŠå®ƒæ‰“åŒ…ï¼š
å¼•å…¥é“¾æ¥
```html
<script
  src="https://code.jquery.com/jquery-3.1.0.js"
  integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk="
  crossorigin="anonymous"
></script>
```

é…ç½® externals
```js
const config = {
  //...
  externals: {
    jquery: 'jQuery',
  },
};
```

ä½¿ç”¨ jQuery
```js
import $ from 'jquery';

$('.my-element').animate(/* ... */);
```
æˆ‘ä»¬å¯ä»¥ç”¨è¿™æ ·çš„æ–¹æ³•æ¥å‰¥ç¦»ä¸éœ€è¦æ”¹åŠ¨çš„ä¸€äº›ä¾èµ–ï¼Œå¤§å¤§èŠ‚çœæ‰“åŒ…æ„å»ºçš„æ—¶é—´ã€‚


## 1.4 ç¼©å°èŒƒå›´
åœ¨é…ç½® loader çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æ›´ç²¾ç¡®çš„å»æŒ‡å®š loader çš„ä½œç”¨ç›®å½•æˆ–è€…éœ€è¦æ’é™¤çš„ç›®å½•ï¼Œé€šè¿‡ä½¿ç”¨ include å’Œ exclude ä¸¤ä¸ªé…ç½®é¡¹ï¼Œå¯ä»¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå¸¸è§çš„ä¾‹å¦‚ï¼š

- includeï¼šç¬¦åˆæ¡ä»¶çš„æ¨¡å—è¿›è¡Œè§£æ
- excludeï¼šæ’é™¤ç¬¦åˆæ¡ä»¶çš„æ¨¡å—ï¼Œä¸è§£æ
- exclude ä¼˜å…ˆçº§æ›´é«˜

ä¾‹å¦‚åœ¨é…ç½® babel çš„æ—¶å€™

```js
const path = require('path');

// è·¯å¾„å¤„ç†æ–¹æ³•
function resolve(dir){
  return path.join(__dirname, dir);
}

const config = {
  //...
  module: { 
    // noParse: /jquery|lodash/,
    rules: [
      {
        test: /\.js$/i,
        include: resolve('src'),
        exclude: /node_modules/,
        use: [
          'babel-loader',
        ]
      },
      // ...
    ]
  }
};

```

## 1.5 noParse

ä¸éœ€è¦è§£æä¾èµ–çš„ç¬¬ä¸‰æ–¹å¤§å‹ç±»åº“ç­‰ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå­—æ®µè¿›è¡Œé…ç½®ï¼Œä»¥æé«˜æ„å»ºé€Ÿåº¦
ä½¿ç”¨ noParse è¿›è¡Œå¿½ç•¥çš„æ¨¡å—æ–‡ä»¶ä¸­ä¸ä¼šè§£æ importã€require ç­‰è¯­æ³•
```js
const config = {
  //...
  module: { 
    noParse: /jquery|lodash/,
    rules:[...]
  }

};
```

## 1.6 IgnorePlugin
é˜²æ­¢åœ¨Â importÂ æˆ–Â requireÂ è°ƒç”¨æ—¶ï¼Œç”Ÿæˆä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ¨¡å—ï¼š

- requestRegExpÂ åŒ¹é…(test)èµ„æºè¯·æ±‚è·¯å¾„çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚
- contextRegExpÂ åŒ¹é…(test)èµ„æºä¸Šä¸‹æ–‡ï¼ˆç›®å½•ï¼‰çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚

```js
new webpack.IgnorePlugin({ resourceRegExp, contextRegExp });
```
ä»¥ä¸‹ç¤ºä¾‹æ¼”ç¤ºäº†æ­¤æ’ä»¶çš„å‡ ç§ç”¨æ³•ã€‚

- å®‰è£… moment æ’ä»¶ï¼ˆæ—¶é—´å¤„ç†åº“ï¼‰
```js
$ npm i -S moment

```
- é…ç½® IgnorePlugin
```js
// å¼•å…¥ webpack
const webpack = require('webpack')

const config = {
  ...
  plugins:[ // é…ç½®æ’ä»¶
    ...
    new webpack.IgnorePlugin({
      resourceRegExp: /^\.\/locale$/,
      contextRegExp: /moment$/,
    }),
  ]  
};
```
ç›®çš„æ˜¯å°†æ’ä»¶ä¸­çš„éä¸­æ–‡è¯­éŸ³æ’é™¤æ‰ï¼Œè¿™æ ·å°±å¯ä»¥å¤§å¤§èŠ‚çœæ‰“åŒ…çš„ä½“ç§¯äº†



## 1.7 å¤šè¿›ç¨‹é…ç½®
> æ³¨æ„ï¼šå®é™…ä¸Šåœ¨å°å‹é¡¹ç›®ä¸­ï¼Œå¼€å¯å¤šè¿›ç¨‹æ‰“åŒ…åè€Œä¼šå¢åŠ æ—¶é—´æˆæœ¬ï¼Œå› ä¸ºå¯åŠ¨è¿›ç¨‹å’Œè¿›ç¨‹é—´é€šä¿¡éƒ½ä¼šæœ‰ä¸€å®šå¼€é”€ã€‚

### 1.7.1 thread-loader
é…ç½®åœ¨ [thread-loader](https://webpack.docschina.org/loaders/thread-loader/#root) ä¹‹åçš„ loader éƒ½ä¼šåœ¨ä¸€ä¸ªå•ç‹¬çš„ worker æ± ï¼ˆworker poolï¼‰ä¸­è¿è¡Œ


https://webpack.docschina.org/loaders/thread-loader/#root

1. å®‰è£…
```bash
$ npm i -D  thread-loader
```

1. é…ç½®
```js
const path = require('path');

// è·¯å¾„å¤„ç†æ–¹æ³•
function resolve(dir){
  return path.join(__dirname, dir);
}

const config = {
  //...
  module: { 
    noParse: /jquery|lodash/,
    rules: [
      {
        test: /\.js$/i,
        include: resolve('src'),
        exclude: /node_modules/,
        use: [
          {
            loader: 'thread-loader', // å¼€å¯å¤šè¿›ç¨‹æ‰“åŒ…
            options: {
              worker: 3,
            }
          },
          'babel-loader',
        ]
      },
      // ...
    ]
  }
};
```
1.7.2 happypack âŒ
åŒæ ·ä¸ºå¼€å¯å¤šè¿›ç¨‹æ‰“åŒ…çš„å·¥å…·ï¼Œwebpack5 å·²å¼ƒç”¨ã€‚


## 1.8 åˆ©ç”¨ç¼“å­˜
åˆ©ç”¨ç¼“å­˜å¯ä»¥å¤§å¹…æå‡é‡å¤æ„å»ºçš„é€Ÿåº¦
### 1.8.1 babel-loader å¼€å¯ç¼“å­˜

babel åœ¨è½¬è¯‘ js è¿‡ç¨‹ä¸­æ—¶é—´å¼€é”€æ¯”ä»·å¤§ï¼Œå°† babel-loader çš„æ‰§è¡Œç»“æœç¼“å­˜èµ·æ¥ï¼Œé‡æ–°æ‰“åŒ…çš„æ—¶å€™ï¼Œç›´æ¥è¯»å–ç¼“å­˜
ç¼“å­˜ä½ç½®ï¼š node_modules/.cache/babel-loader

å…·ä½“é…ç½®å¦‚ä¸‹ï¼š
```js
const config = {
 module: { 
    noParse: /jquery|lodash/,
    rules: [
      {
        test: /\.js$/i,
        include: resolve('src'),
        exclude: /node_modules/,
        use: [
          // ...
          {
            loader: 'babel-loader',
            options: {
              cacheDirectory: true // å¯ç”¨ç¼“å­˜
            }
          },
        ]
      },
      // ...
    ]
  }
}
```
é‚£å…¶ä»–çš„ loader å¦‚ä½•å°†ç»“æœç¼“å­˜å‘¢ï¼Ÿ
 cache-loader å°±å¯ä»¥å¸®æˆ‘ä»¬å®Œæˆè¿™ä»¶äº‹æƒ…
### 1.8.2 cache-loader

ç¼“å­˜ä¸€äº›æ€§èƒ½å¼€é”€æ¯”è¾ƒå¤§çš„ loader çš„å¤„ç†ç»“æœ
ç¼“å­˜ä½ç½®ï¼šnode_modules/.cache/cache-loader
- å®‰è£…
```bash
$ npm i -D cache-loader
```

- é…ç½® cache-loader
```js
const config = {
 module: { 
    // ...
    rules: [
      {
        test: /\.(s[ac]|c)ss$/i, //åŒ¹é…æ‰€æœ‰çš„ sass/scss/css æ–‡ä»¶
        use: [
          // 'style-loader',
          MiniCssExtractPlugin.loader,
          'cache-loader', // è·å–å‰é¢ loader è½¬æ¢çš„ç»“æœ
          'css-loader',
          'postcss-loader',
          'sass-loader', 
        ]
      }, 
      // ...
    ]
  }
}
```
### 1.8.3 hard-source-webpack-plugin

[hard-source-webpack-plugin.](https://github.com/mzgoddard/hard-source-webpack-plugin) ä¸ºæ¨¡å—æä¾›äº†ä¸­é—´ç¼“å­˜ï¼Œé‡å¤æ„å»ºæ—¶é—´å¤§çº¦å¯ä»¥å‡å°‘ 80%ï¼Œä½†æ˜¯åœ¨ webpack5 ä¸­å·²ç»å†…ç½®äº†æ¨¡å—ç¼“å­˜ï¼Œä¸éœ€è¦å†ä½¿ç”¨æ­¤æ’ä»¶
### 1.8.4 dll âŒ
åœ¨ webpack5.x ä¸­å·²ç»ä¸å»ºè®®ä½¿ç”¨è¿™ç§æ–¹å¼è¿›è¡Œæ¨¡å—ç¼“å­˜ï¼Œå› ä¸ºå…¶å·²ç»å†…ç½®äº†æ›´å¥½ä½“éªŒçš„ cache æ–¹æ³•
### 1.8.5 cache æŒä¹…åŒ–ç¼“å­˜
é€šè¿‡é…ç½® cache ç¼“å­˜ç”Ÿæˆçš„ webpack æ¨¡å—å’Œ chunkï¼Œæ¥æ”¹å–„æ„å»ºé€Ÿåº¦ã€‚
```js
const config = {
  cache: {
    type: 'filesystem',
  },
};

```