# ç®€å•é…ç½®
> è¯¥éƒ¨åˆ†éœ€è¦æŒæ¡ï¼š

    Webpack å¸¸è§„é…ç½®é¡¹æœ‰å“ªäº›ï¼Ÿ
    å¸¸ç”¨ Loader æœ‰å“ªäº›ï¼Ÿå¦‚ä½•é…ç½®ï¼Ÿ
    å¸¸ç”¨æ’ä»¶ï¼ˆPluginï¼‰æœ‰å“ªäº›ï¼Ÿå¦‚ä½•çš„é…ç½®ï¼Ÿ
    Babel çš„å¦‚ä½•é…ç½®ï¼ŸBabel æ’ä»¶å¦‚ä½•ä½¿ç”¨ï¼Ÿ


## 1.1 å®‰è£…ä¾èµ–
æ¯«æ— ç–‘é—®ï¼Œå…ˆæœ¬åœ°å®‰è£…ä¸€ä¸‹ webpack ä»¥åŠ webpack-cli
```js
npm install webpack webpack-cli -D # å®‰è£…åˆ°æœ¬åœ°ä¾èµ–
```
å®‰è£…å®Œæˆ âœ…
+ webpack-cli@4.7.2
+ webpack@5.44.0


## 1.2 å·¥ä½œæ¨¡å¼
webpack åœ¨ 4 ä»¥åå°±æ”¯æŒ 0 é…ç½®æ‰“åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹
æ–°å»º ./src/index.js æ–‡ä»¶ï¼Œå†™ä¸€æ®µç®€å•çš„ä»£ç 
```js
const a = 'Hello ITEM'
console.log(a)
module.exports = a;
```
æ­¤æ—¶ç›®å½•ç»“æ„
webpack_work                  
â”œâ”€ src                
â”‚  â””â”€ index.js         
â””â”€ package.json       
ç›´æ¥è¿è¡Œ npx webpackï¼Œå¯åŠ¨æ‰“åŒ…
æ‰“åŒ…å®Œæˆï¼Œæˆ‘ä»¬çœ‹åˆ°æ—¥å¿—ä¸Šé¢æœ‰ä¸€æ®µæç¤ºï¼šThe 'mode' option has not been set,...

æ„æ€å°±æ˜¯ï¼Œæˆ‘ä»¬æ²¡æœ‰é…ç½® modeï¼ˆæ¨¡å¼ï¼‰ï¼Œè¿™é‡Œæé†’æˆ‘ä»¬é…ç½®ä¸€ä¸‹

åªéœ€åœ¨é…ç½®å¯¹è±¡ä¸­æä¾› mode é€‰é¡¹ï¼š
```js
module.exports = {
  mode: 'development',
};
```
ä» CLI å‚æ•°ä¸­ä¼ é€’ï¼š
```js
$ webpack --mode=development
```

## 1.3 è‡ªåŠ¨æ¸…ç©ºæ‰“åŒ…ç›®å½•

æ¯æ¬¡æ‰“åŒ…çš„æ—¶å€™ï¼Œæ‰“åŒ…ç›®å½•éƒ½ä¼šé—ç•™ä¸Šæ¬¡æ‰“åŒ…çš„æ–‡ä»¶ï¼Œä¸ºäº†ä¿æŒæ‰“åŒ…ç›®å½•çš„çº¯å‡€ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ‰“åŒ…å‰å°†æ‰“åŒ…ç›®å½•æ¸…ç©º

è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ’ä»¶ clean-webpack-plugin æ¥å®ç°

å®‰è£…
```js
$ npm install clean-webpack-plugin -D
```

é…ç½®
```js
const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')
// å¼•å…¥æ’ä»¶
const { CleanWebpackPlugin } = require('clean-webpack-plugin')

module.exports = {
  // ...
  plugins:[ // é…ç½®æ’ä»¶
    new HtmlWebpackPlugin({
      template: './src/index.html'
    }),
    new CleanWebpackPlugin() // å¼•å…¥æ’ä»¶
  ]
}
```

## 1.4 åŒºåˆ†ç¯å¢ƒ
æœ¬åœ°å¼€å‘å’Œéƒ¨ç½²çº¿ä¸Šï¼Œè‚¯å®šæ˜¯æœ‰ä¸åŒçš„éœ€æ±‚
- æœ¬åœ°ç¯å¢ƒï¼š

éœ€è¦æ›´å¿«çš„æ„å»ºé€Ÿåº¦
éœ€è¦æ‰“å° debug ä¿¡æ¯
éœ€è¦ live reload æˆ– hot reload åŠŸèƒ½
éœ€è¦ sourcemap æ–¹ä¾¿å®šä½é—®é¢˜
...

- ç”Ÿäº§ç¯å¢ƒï¼š

éœ€è¦æ›´å°çš„åŒ…ä½“ç§¯ï¼Œä»£ç å‹ç¼©+tree-shaking
éœ€è¦è¿›è¡Œä»£ç åˆ†å‰²
éœ€è¦å‹ç¼©å›¾ç‰‡ä½“ç§¯
...

é’ˆå¯¹ä¸åŒçš„éœ€æ±‚ï¼Œé¦–å…ˆè¦åšçš„å°±æ˜¯åšå¥½ç¯å¢ƒçš„åŒºåˆ†

1. æœ¬åœ°å®‰è£… cross-env [https://www.npmjs.com/package/cross-env]
```
npm install cross-env -D
```
2. é…ç½®å¯åŠ¨å‘½ä»¤
æ‰“å¼€ ./package.json

```js
"scripts": {
    "dev": "cross-env NODE_ENV=dev webpack serve --mode development", 
    "test": "cross-env NODE_ENV=test webpack --mode production",
    "build": "cross-env NODE_ENV=prod webpack --mode production"
  },
```
3. åœ¨ Webpack é…ç½®æ–‡ä»¶ä¸­è·å–ç¯å¢ƒå˜é‡

```js
const path = require('path')
const HtmlWebpackPlugin = require('html-webpack-plugin')

console.log('process.env.NODE_ENV=', process.env.NODE_ENV) // æ‰“å°ç¯å¢ƒå˜é‡

const config = {
  entry: './src/index.js', // æ‰“åŒ…å…¥å£åœ°å€
  output: {
    filename: 'bundle.js', // è¾“å‡ºæ–‡ä»¶å
    path: path.join(__dirname, 'dist') // è¾“å‡ºæ–‡ä»¶ç›®å½•
  },
  module: { 
    rules: [
      {
        test: /\.css$/, //åŒ¹é…æ‰€æœ‰çš„ css æ–‡ä»¶
        use: 'css-loader' // use: å¯¹åº”çš„ Loader åç§°
      }
    ]
  },
  plugins:[ // é…ç½®æ’ä»¶
    new HtmlWebpackPlugin({
      template: './src/index.html'
    })
  ]
}

module.exports = (env, argv) => {
  console.log('argv.mode=',argv.mode) // æ‰“å° mode(æ¨¡å¼) å€¼
  // è¿™é‡Œå¯ä»¥é€šè¿‡ä¸åŒçš„æ¨¡å¼ä¿®æ”¹ config é…ç½®
  return config;
}

```

## 1.5 å¯åŠ¨ devServer

1. å®‰è£… webpack-dev-server [https://webpack.docschina.org/configuration/dev-server/#devserver]
```js
npm intall webpack-dev-server@3.11.2 -D

```

> æ³¨æ„ï¼šæœ¬æ–‡ä½¿ç”¨çš„ webpack-dev-server ç‰ˆæœ¬æ˜¯ 3.11.2ï¼Œå½“ç‰ˆæœ¬ version >= 4.0.0 æ—¶ï¼Œéœ€è¦ä½¿ç”¨ devServer.static è¿›è¡Œé…ç½®ï¼Œä¸å†æœ‰ devServer.contentBase é…ç½®é¡¹ã€‚


2. é…ç½®æœ¬åœ°æœåŠ¡

```js
// webpack.config.js
const config = {
  // ...
  devServer: {
    contentBase: path.resolve(__dirname, 'public'), // é™æ€æ–‡ä»¶ç›®å½•
    compress: true, //æ˜¯å¦å¯åŠ¨å‹ç¼© gzip
    port: 8080, // ç«¯å£å·
    // open:true  // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  },
 // ...
}
module.exports = (env, argv) => {
  console.log('argv.mode=',argv.mode) // æ‰“å° mode(æ¨¡å¼) å€¼
  // è¿™é‡Œå¯ä»¥é€šè¿‡ä¸åŒçš„æ¨¡å¼ä¿®æ”¹ config é…ç½®
  return config;
}

```

ä¸ºä»€ä¹ˆè¦é…ç½® contentBase ï¼Ÿ
å› ä¸º webpack åœ¨è¿›è¡Œæ‰“åŒ…çš„æ—¶å€™ï¼Œå¯¹é™æ€æ–‡ä»¶çš„å¤„ç†ï¼Œä¾‹å¦‚å›¾ç‰‡ï¼Œéƒ½æ˜¯ç›´æ¥ copy åˆ° dist ç›®å½•ä¸‹é¢ã€‚ä½†æ˜¯å¯¹äºæœ¬åœ°å¼€å‘æ¥è¯´ï¼Œè¿™ä¸ªè¿‡ç¨‹å¤ªè´¹æ—¶ï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ï¼Œæ‰€ä»¥åœ¨è®¾ç½® contentBase ä¹‹åï¼Œå°±ç›´æ¥åˆ°å¯¹åº”çš„é™æ€ç›®å½•ä¸‹é¢å»è¯»å–æ–‡ä»¶ï¼Œè€Œä¸éœ€å¯¹æ–‡ä»¶åšä»»ä½•ç§»åŠ¨ï¼ŒèŠ‚çœäº†æ—¶é—´å’Œæ€§èƒ½å¼€é”€ã€‚

> webpack-dev-server v4.0.0+ è¦æ±‚ node >= v12.13.0ã€webpack >= v4.37.0ï¼ˆä½†æ˜¯æˆ‘ä»¬æ¨èä½¿ç”¨ webpack >= v5.0.0ï¼‰å’Œ webpack-cli >= v4.7.0ã€‚


```js
  devServer: {
    static: {
      directory: path.join(__dirname, 'public'),
    },
    compress: true, //æ˜¯å¦å¯åŠ¨å‹ç¼© gzip
    port: 9000,
    open: true, // æ˜¯å¦è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  },

```
3. å¯åŠ¨æœ¬åœ°æœåŠ¡

```js
$ npm run dev
```
ä¸ºäº†çœ‹åˆ°æ•ˆæœï¼Œæˆ‘åœ¨ html ä¸­æ·»åŠ äº†ä¸€æ®µæ–‡å­—ï¼Œå¹¶åœ¨ public ä¸‹é¢æ”¾å…¥äº†ä¸€å¼ å›¾ç‰‡ logo.png

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ITEM</title>
</head>
<body>
  <p>ITEM</p>
</body>
</html>

```

```
public       
â””â”€ logo.png  

```
æ‰“å¼€åœ°å€ http://localhost:8080/
![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/86b5b3175a2a47248c8da77cf51b752d~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

æ¥ç€è®¿é—® http://localhost:8080/logo.png

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa86c70642db455c91a2c49129dfe9c2~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)



## 1,6 å¼•å…¥ CSS
ä¸Šé¢ï¼Œæˆ‘ä»¬åœ¨ Loader é‡Œé¢è®²åˆ°äº†ä½¿ç”¨ css-loader æ¥å¤„ç† cssï¼Œä½†æ˜¯å•é  css-loader æ˜¯æ²¡æœ‰åŠæ³•å°†æ ·å¼åŠ è½½åˆ°é¡µé¢ä¸Šã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å†å®‰è£…ä¸€ä¸ª style-loader æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½
style-loader å°±æ˜¯å°†å¤„ç†å¥½çš„ css é€šè¿‡ style æ ‡ç­¾çš„å½¢å¼æ·»åŠ åˆ°é¡µé¢ä¸Š

å®‰è£… style-loader [æ–‡æ¡£åœ°å€]
```js
npm install style-loader -D
```

é…ç½® Loader
```js
const config = {
  // ...
  module: { 
    rules: [
      {
        test: /\.css$/, //åŒ¹é…æ‰€æœ‰çš„ css æ–‡ä»¶
        use: ['style-loader','css-loader']
      }
    ]
  },
  // ...
}
```

âš ï¸æ³¨æ„ï¼š Loader çš„æ‰§è¡Œé¡ºåºæ˜¯å›ºå®šä»åå¾€å‰ï¼Œå³æŒ‰ css-loader --> style-loader çš„é¡ºåºæ‰§è¡Œ


å¼•ç”¨æ ·å¼æ–‡ä»¶

åœ¨å…¥å£æ–‡ä»¶ ./src/index.js å¼•å…¥æ ·å¼æ–‡ä»¶ ./src/main.css

```js
// ./src/index.js
import './main.css';


const a = 'Hello ITEM'
console.log(a)
module.exports = a;
```


```js
/* ./src/main.css */ 
body {
  margin: 10px auto;
  background: cyan;
  max-width: 800px;
}
```


é‡å¯ä¸€ä¸‹æœ¬åœ°æœåŠ¡ï¼Œè®¿é—® http://localhost:8080/
![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a39e673799d42338feb714bc0d5c88e~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

è¿™æ ·æ ·å¼å°±èµ·ä½œç”¨äº†ï¼Œç»§ç»­ä¿®æ”¹ä¸€ä¸‹æ ·å¼
```js
body {
  margin: 10px auto;
  background: cyan;
  max-width: 800px;
  /* æ–°å¢ */
  font-size: 46px;
  font-weight: 600;
  color: white;
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
}
```
ä¿å­˜ä¹‹åï¼Œæ ·å¼å°±è‡ªåŠ¨ä¿®æ”¹å®Œæˆäº†

style-loader æ ¸å¿ƒé€»è¾‘ç›¸å½“äºï¼š
```js
const content = `${æ ·å¼å†…å®¹}`
const style = document.createElement('style');
style.innerHTML = content;
document.head.appendChild(style);
```
é€šè¿‡åŠ¨æ€æ·»åŠ  style æ ‡ç­¾çš„æ–¹å¼ï¼Œå°†æ ·å¼å¼•å…¥é¡µé¢


## 1.7 CSS å…¼å®¹æ€§
ä½¿ç”¨ [postcss-loader](https://webpack.docschina.org/loaders/postcss-loader/)ï¼Œè‡ªåŠ¨æ·»åŠ  CSS3 éƒ¨åˆ†å±æ€§çš„æµè§ˆå™¨å‰ç¼€
ä¸Šé¢æˆ‘ä»¬ç”¨åˆ°çš„ transform: translateX(-50%);ï¼Œéœ€è¦åŠ ä¸Šä¸åŒçš„æµè§ˆå™¨å‰ç¼€ï¼Œè¿™ä¸ªæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ postcss-loader æ¥å¸®åŠ©æˆ‘ä»¬å®Œæˆ

1. å®‰è£…

```js
npm install postcss postcss-loader postcss-preset-env -D
```

2. æ·»åŠ  postcss-loader åŠ è½½å™¨

```js
const config = {
  // ...
  module: { 
    rules: [
      {
        test: /\.css$/, //åŒ¹é…æ‰€æœ‰çš„ css æ–‡ä»¶
        use: [
          'style-loader',
          'css-loader', 
          'postcss-loader'
        ]
      }
    ]
  }, 
  // ...
}

```

3. åˆ›å»º postcss é…ç½®æ–‡ä»¶ postcss.config.js

```js
// postcss.config.js
module.exports = {
  plugins: [require('postcss-preset-env')]
}

```

4. åˆ›å»º postcss-preset-env é…ç½®æ–‡ä»¶ .browserslistrc

```js
# æ¢è¡Œç›¸å½“äº and
last 2 versions # å›é€€ä¸¤ä¸ªæµè§ˆå™¨ç‰ˆæœ¬
> 0.5% # å…¨çƒè¶…è¿‡0.5%äººä½¿ç”¨çš„æµè§ˆå™¨ï¼Œå¯ä»¥é€šè¿‡ caniuse.com æŸ¥çœ‹ä¸åŒæµè§ˆå™¨ä¸åŒç‰ˆæœ¬å æœ‰ç‡
IE 10 # å…¼å®¹IE 10
```

## 1.8  å¼•å…¥ Less æˆ–è€… Sass

less å’Œ sass åŒæ ·æ˜¯ Webpack æ— æ³•è¯†åˆ«çš„ï¼Œéœ€è¦ä½¿ç”¨å¯¹åº”çš„ Loader æ¥å¤„ç†ä¸€ä¸‹
```js
Less	less-loader
Sass	sass-loader node-sass æˆ– dart-sass
```
Less å¤„ç†ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œç›´æ¥æ·»åŠ å¯¹åº”çš„ Loader å°±å¥½äº†
Sass ä¸å…‰éœ€è¦å®‰è£… sass-loader è¿˜å¾—æ­é…ä¸€ä¸ª node-sassï¼Œè¿™é‡Œ node-sass å»ºè®®ç”¨æ·˜å®é•œåƒæ¥å®‰è£…ï¼Œnpm å®‰è£…æˆåŠŸçš„æ¦‚ç‡å¤ªå°äº† ğŸ¤£
è¿™é‡Œæˆ‘ä»¬å°±ä½¿ç”¨ Sass æ¥åšæ¡ˆä¾‹

1. å®‰è£…

```js
$ npm install sass-loader -D
# æ·˜å®é•œåƒ
$ npm i node-sass --sass_binary_site=https://npm.taobao.org/mirrors/node-sass/
```

2. æ–°å»º ./src/sass.scss
Sass æ–‡ä»¶çš„åç¼€å¯ä»¥æ˜¯ .scss(å¸¸ç”¨) æˆ–è€… .sass
```css
$color: rgb(190, 23, 168);

body {
  p {
    background-color: $color;
    width: 300px;
    height: 300px;
    display: block;
    text-align: center;
    line-height: 300px;
  }
}

```

3. å¼•å…¥ Sass æ–‡ä»¶

```js 
import './main.css';
import './sass.scss' // å¼•å…¥ Sass æ–‡ä»¶


const a = 'Hello ITEM'
console.log(a)
module.exports = a;

```

4. ä¿®æ”¹é…ç½®

```js
const config = {
   // ...
   rules: [
      {
        test: /\.(s[ac]|c)ss$/i, //åŒ¹é…æ‰€æœ‰çš„ sass/scss/css æ–‡ä»¶
        use: [
          'style-loader',
          'css-loader',
          'postcss-loader',
          'sass-loader', 
        ]
      },
    ]
  },
  // ...
}

```

æ¥çœ‹ä¸€ä¸‹æ‰§è¡Œç»“æœ
![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a6e15eec0674eb6be0eb8b18b5f8e3f~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)


# 1.9 åˆ†ç¦»æ ·å¼æ–‡ä»¶
å‰é¢ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä¾èµ– style-loader å°†æ ·å¼é€šè¿‡ style æ ‡ç­¾çš„å½¢å¼æ·»åŠ åˆ°é¡µé¢ä¸Š
ä½†æ˜¯ï¼Œæ›´å¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›å¯ä»¥é€šè¿‡ CSS æ–‡ä»¶çš„å½¢å¼å¼•å…¥åˆ°é¡µé¢ä¸Š

1. å®‰è£… mini-css-extract-plugin

```
$ npm install mini-css-extract-plugin -D

```

2. ä¿®æ”¹ webpack.config.js é…ç½®

```js
// ...
// å¼•å…¥æ’ä»¶
const MiniCssExtractPlugin = require('mini-css-extract-plugin')


const config = {
  // ...
  module: { 
    rules: [
      // ...
      {
        test: /\.(s[ac]|c)ss$/i, //åŒ¹é…æ‰€æœ‰çš„ sass/scss/css æ–‡ä»¶
        use: [
          // 'style-loader',
          MiniCssExtractPlugin.loader, // æ·»åŠ  loader
          'css-loader',
          'postcss-loader',
          'sass-loader', 
        ] 
      },
    ]
  },
  // ...
  plugins:[ // é…ç½®æ’ä»¶
    // ...
    new MiniCssExtractPlugin({ // æ·»åŠ æ’ä»¶
      filename: '[name].[hash:8].css'
    }),
    // ...
  ]
}

// ...

```

3. æŸ¥çœ‹æ‰“åŒ…ç»“æœ

```js
dist                    
â”œâ”€ avatar.d4d42d52.png  
â”œâ”€ bundle.js            
â”œâ”€ index.html           
â”œâ”€ logo.56482c77.png    
â””â”€ main.3bcbae64.css # ç”Ÿæˆçš„æ ·å¼æ–‡ä»¶  

```

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eeb21ada61c14841bb340f9a8cb36aca~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

## 1.10  å›¾ç‰‡æ–‡ä»¶

å¸¸ç”¨çš„å¤„ç†å›¾ç‰‡æ–‡ä»¶çš„ Loader åŒ…å«ï¼š

- file-loader è§£å†³å›¾ç‰‡å¼•å…¥é—®é¢˜ï¼Œå¹¶å°†å›¾ç‰‡ copy åˆ°æŒ‡å®šç›®å½•ï¼Œé»˜è®¤ä¸º dist
- url-loaderè§£ä¾èµ– file-loaderï¼Œå½“å›¾ç‰‡å°äº limit å€¼çš„æ—¶å€™ï¼Œä¼šå°†å›¾ç‰‡è½¬ä¸º base64 ç¼–ç ï¼Œå¤§äº limit å€¼çš„æ—¶å€™ä¾ç„¶æ˜¯ä½¿ç”¨ file-loader è¿›è¡Œæ‹·è´
- img-loaderå‹ç¼©å›¾ç‰‡

1. å®‰è£… file-loader

```js
npm install file-loader -D
```

2. ä¿®æ”¹é…ç½®

```js
const config = {
  //...
  module: { 
    rules: [
      {
         // ...
      }, 
      {
        test: /\.(jpe?g|png|gif)$/i, // åŒ¹é…å›¾ç‰‡æ–‡ä»¶
        use:[
          'file-loader' // ä½¿ç”¨ file-loader
        ]
      }
    ]
  },
  // ...
}

```

3. å¼•å…¥å›¾ç‰‡

```js
<!-- ./src/index.html -->
<!DOCTYPE html>
<html lang="en">
...
<body>
  <p></p>
  <div id="imgBox"></div>
</body>
</html>

```

æ ·å¼æ–‡ä»¶ä¸­å¼•å…¥

```js
/* ./src/sass.scss */

$color: rgb(190, 23, 168);

body {
  p {
    width: 300px;
    height: 300px;
    display: block;
    text-align: center;
    line-height: 300px;
    background: url('../public/logo.png');
    background-size: contain;
  }
}


```

js æ–‡ä»¶ä¸­å¼•å…¥

```js
import './main.css';
import './sass.scss'
import logo from '../public/avatar.png'

const a = 'Hello ITEM'
console.log(a)

const img = new Image()
img.src = logo

document.getElementById('imgBox').appendChild(img)

```

å¯åŠ¨æœåŠ¡ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ•ˆæœ
![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d1a5bc99ab384641912b82ce921b62c5~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

æ˜¾ç¤ºæ­£å¸¸ âœŒï¸

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å›¾ç‰‡æ–‡ä»¶çš„åå­—éƒ½å·²ç»å˜äº†ï¼Œå¹¶ä¸”å¸¦ä¸Šäº† hash å€¼ï¼Œç„¶åæˆ‘çœ‹ä¸€ä¸‹æ‰“åŒ…ç›®å½•

```
dist                                     
â”œâ”€ 56482c77280b3c4ad2f083b727dfcbf9.png  
â”œâ”€ bundle.js                             
â”œâ”€ d4d42d529da4b5120ac85878f6f69694.png  
â””â”€ index.html                            

```

dist ç›®å½•ä¸‹é¢å¤šäº†ä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿™æ­£æ˜¯ file-loader æ‹·è´è¿‡æ¥çš„

å¦‚æœæƒ³è¦ä¿®æ”¹ä¸€ä¸‹åç§°ï¼Œå¯ä»¥åŠ ä¸ªé…ç½®

```js
const config = {
  //...
  module: { 
    rules: [
      {
         // ...
      }, 
      {
        test: /\.(jpe?g|png|gif)$/i,
        use:[
          {
            loader: 'file-loader',
            options: {
              name: '[name][hash:8].[ext]'
            }
          }
        ]
      }
    ]
  },
  // ...
}

```

å†æ¬¡æ‰“åŒ…çœ‹ä¸€ä¸‹

```js
dist                   
â”œâ”€ avatard4d42d52.png  
â”œâ”€ bundle.js           
â”œâ”€ index.html          
â””â”€ logo56482c77.png    
```
4. å®‰è£… url-loader

```
$ npm install url-loader -D

```

5. é…ç½® url-loader
é…ç½®å’Œ file-loader ç±»ä¼¼ï¼Œå¤šäº†ä¸€ä¸ª limit çš„é…ç½®

```js
const config = {
  //...
  module: { 
    rules: [
      {
         // ...
      }, 
      {
        test: /\.(jpe?g|png|gif)$/i,
        use:[
          {
            loader: 'url-loader',
            options: {
              name: '[name][hash:8].[ext]',
              // æ–‡ä»¶å°äº 50k ä¼šè½¬æ¢ä¸º base64ï¼Œå¤§äºåˆ™æ‹·è´æ–‡ä»¶
              limit: 50 * 1024
            }
          }
        ]
      },
    ]
  },
  // ...
}

```

çœ‹ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¸¤ä¸ªå›¾ç‰‡æ–‡ä»¶çš„ä½“ç§¯

```jss
public         
â”œâ”€ avatar.png # 167kb
â””â”€ logo.png   # 43kb 

```

æˆ‘ä»¬æ‰“åŒ…çœ‹ä¸€ä¸‹æ•ˆæœ
![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/87741d3bd67a4b7fbe3a8ce626690579~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

å¾ˆæ˜æ˜¾å¯ä»¥çœ‹åˆ° logo.png æ–‡ä»¶å·²ç»è½¬ä¸º base64 äº†ğŸ‘Œ


## 1.11  å­—ä½“æ–‡ä»¶

1. é¦–å…ˆï¼Œä» [iconfont.cn](https://www.iconfont.cn/home/index?spm=a313x.7781069.1998910419.2) ä¸‹è½½å­—ä½“æ–‡ä»¶åˆ°æœ¬åœ°

2. åœ¨é¡¹ç›®ä¸­ï¼Œæ–°å»º ./src/fonts æ–‡ä»¶å¤¹æ¥å­˜æ”¾å­—ä½“æ–‡ä»¶ ç„¶åï¼Œå¼•å…¥åˆ°å…¥å£æ–‡ä»¶

```js
// ./src/index.js

import './main.css';
import './sass.scss'
import logo from '../public/avatar.png'

// å¼•å…¥å­—ä½“å›¾æ ‡æ–‡ä»¶
import './fonts/iconfont.css'

const a = 'Hello ITEM'
console.log(a)

const img = new Image()
img.src = logo

document.getElementById('imgBox').appendChild(img)

```

3. åœ¨ ./src/index.html ä¸­ä½¿ç”¨

```js
<!DOCTYPE html>
<html lang="en">
...
<body>
  <p></p>
  <!-- ä½¿ç”¨å­—ä½“å›¾æ ‡æ–‡ä»¶ -->
  <!-- 1ï¼‰iconfont å¯¹åº” font-family è®¾ç½®çš„å€¼-->
  <!-- 2ï¼‰icon-member å›¾æ ‡ class åç§°å¯ä»¥åœ¨ iconfont.cn ä¸­æŸ¥æ‰¾-->
  <i class="iconfont icon-member"></i>
  <div id="imgBox"></div>
</body>
</html>

```

4. å¢åŠ å­—ä½“æ–‡ä»¶çš„é…ç½®

```js
const config = {
  // ...
  {
    test: /\.(woff2?|eot|ttf|otf)(\?.*)?$/i,  // åŒ¹é…å­—ä½“æ–‡ä»¶
    use: [
      {
        loader: 'url-loader',
        options: {
          name: 'fonts/[name][hash:8].[ext]', // ä½“ç§¯å¤§äº 10KB æ‰“åŒ…åˆ° fonts ç›®å½•ä¸‹ 
          limit: 10 * 1024,
        } 
      }
    ]
  },
  // ...
}

```

æ‰“åŒ…ä¸€ä¸‹ï¼Œçœ‹çœ‹æ•ˆæœ
![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5a0646f552f1458fb290efb2be864360~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)


> webpack5ï¼Œå†…ç½®äº†èµ„æºå¤„ç†æ¨¡å—ï¼Œfile-loader å’Œ url-loader éƒ½å¯ä»¥ä¸ç”¨å®‰è£…

## 1.12 èµ„æºæ¨¡å—çš„ä½¿ç”¨
> webpack5 æ–°å¢èµ„æºæ¨¡å—(asset module)ï¼Œå…è®¸ä½¿ç”¨èµ„æºæ–‡ä»¶ï¼ˆå­—ä½“ï¼Œå›¾æ ‡ç­‰ï¼‰è€Œæ— éœ€é…ç½®é¢å¤–çš„ loaderã€‚

èµ„æºæ¨¡å—æ”¯æŒä»¥ä¸‹å››ä¸ªé…ç½®ï¼š

> 1. asset/resource å°†èµ„æºåˆ†å‰²ä¸ºå•ç‹¬çš„æ–‡ä»¶ï¼Œå¹¶å¯¼å‡º urlï¼Œç±»ä¼¼ä¹‹å‰çš„ file-loader çš„åŠŸèƒ½.
  2. asset/inline å°†èµ„æºå¯¼å‡ºä¸º dataUrl çš„å½¢å¼ï¼Œç±»ä¼¼ä¹‹å‰çš„ url-loader çš„å°äº limit å‚æ•°æ—¶åŠŸèƒ½.
  3. asset/source å°†èµ„æºå¯¼å‡ºä¸ºæºç ï¼ˆsource codeï¼‰. ç±»ä¼¼çš„ raw-loader åŠŸèƒ½.
  4. asset ä¼šæ ¹æ®æ–‡ä»¶å¤§å°æ¥é€‰æ‹©ä½¿ç”¨å“ªç§ç±»å‹ï¼Œå½“æ–‡ä»¶å°äº 8 KBï¼ˆé»˜è®¤ï¼‰ çš„æ—¶å€™ä¼šä½¿ç”¨ asset/inlineï¼Œå¦åˆ™ä¼šä½¿ç”¨ asset/resource


è´´ä¸€ä¸‹ä¿®æ”¹åçš„å®Œæ•´ä»£ç 

```js
// ./src/index.js

const config = {
  // ...
  module: { 
    rules: [
      // ... 
      {
        test: /\.(jpe?g|png|gif)$/i,
        type: 'asset',
        generator: {
          // è¾“å‡ºæ–‡ä»¶ä½ç½®ä»¥åŠæ–‡ä»¶å
          // [ext] è‡ªå¸¦ "." è¿™ä¸ªä¸ url-loader é…ç½®ä¸åŒ
          filename: "[name][hash:8][ext]"
        },
        parser: {
          dataUrlCondition: {
            maxSize: 50 * 1024 //è¶…è¿‡50kbä¸è½¬ base64
          }
        }
      },
      {
        test: /\.(woff2?|eot|ttf|otf)(\?.*)?$/i,
        type: 'asset',
        generator: {
          // è¾“å‡ºæ–‡ä»¶ä½ç½®ä»¥åŠæ–‡ä»¶å
          filename: "[name][hash:8][ext]"
        },
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024 // è¶…è¿‡100kbä¸è½¬ base64
          }
        }
      },
    ]
  },
  // ...
}

module.exports = (env, argv) => {
  console.log('argv.mode=',argv.mode) // æ‰“å° mode(æ¨¡å¼) å€¼
  // è¿™é‡Œå¯ä»¥é€šè¿‡ä¸åŒçš„æ¨¡å¼ä¿®æ”¹ config é…ç½®
  return config;
}

```

## 1.13 JS å…¼å®¹æ€§ï¼ˆBabelï¼‰

åœ¨å¼€å‘ä¸­æˆ‘ä»¬æƒ³ä½¿ç”¨æœ€æ–°çš„ Js ç‰¹æ€§ï¼Œä½†æ˜¯æœ‰äº›æ–°ç‰¹æ€§çš„æµè§ˆå™¨æ”¯æŒå¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œæ‰€ä»¥ Js ä¹Ÿéœ€è¦åšå…¼å®¹å¤„ç†ï¼Œå¸¸è§çš„å°±æ˜¯å°† ES6 è¯­æ³•è½¬åŒ–ä¸º ES5ã€‚

è¿™é‡Œå°†ç™»åœºçš„â€œå…¨åœºæœ€é“çš„ä»”â€ -- Babel

1. æœªé…ç½® Babel
æˆ‘ä»¬å†™ç‚¹ ES6 çš„ä¸œè¥¿

```js
// ./src/index.js

import './main.css';
import './sass.scss'
import logo from '../public/avatar.png'

import './fonts/iconfont.css'

// ...

class Author {
  name = 'ITEM'
  age = 18
  email = 'lxp_work@163.com'

  info =  () => {
    return {
      name: this.name,
      age: this.age,
      email: this.email
    }
  }
}


module.exports = Author


```

ä¸ºäº†æ–¹ä¾¿çœ‹æºç ï¼Œæˆ‘ä»¬æŠŠ mode æ¢æˆ development

æ¥ç€æ‰§è¡Œæ‰“åŒ…å‘½ä»¤

æ‰“åŒ…å®Œæˆä¹‹åï¼Œæ‰“å¼€ bundle.js æŸ¥çœ‹æ‰“åŒ…åçš„ç»“æœ

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7599da93b146442b89380f1a0b6b60d9~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)


![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72c389e772c84716bc2d39d9d3460f63~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

è™½ç„¶æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥æ‰¾æ‰“æˆ‘ä»¬çš„ä»£ç ï¼Œä½†æ˜¯é˜…è¯»èµ·æ¥æ¯”è¾ƒä¸ç›´è§‚ï¼Œæˆ‘ä»¬å…ˆè®¾ç½® mode ä¸º noneï¼Œä»¥æœ€åŸå§‹çš„å½¢å¼æ‰“åŒ…ï¼Œå†çœ‹ä¸€ä¸‹æ‰“åŒ…ç»“æœ

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2d7d5965779444d9a0e547f0643de1f~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

æ‰“åŒ…åçš„ä»£ç å˜åŒ–ä¸å¤§ï¼Œåªæ˜¯å¯¹å›¾ç‰‡åœ°å€åšäº†æ›¿æ¢ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹é…ç½® babel åçš„æ‰“åŒ…ç»“æœä¼šæœ‰ä»€ä¹ˆå˜åŒ–

2. å®‰è£…ä¾èµ–

```js
$ npm install babel-loader @babel/core @babel/preset-env -D

```
- babel-loader ä½¿ç”¨ Babel åŠ è½½ ES2015+ ä»£ç å¹¶å°†å…¶è½¬æ¢ä¸º ES5
- @babel/core Babel ç¼–è¯‘çš„æ ¸å¿ƒåŒ…
- @babel/preset-env Babel ç¼–è¯‘çš„é¢„è®¾ï¼Œå¯ä»¥ç†è§£ä¸º Babel æ’ä»¶çš„è¶…é›†


3. é…ç½® Babel é¢„è®¾

```js
// webpack.config.js
// ...
const config = {
  entry: './src/index.js', // æ‰“åŒ…å…¥å£åœ°å€
  output: {
    filename: 'bundle.js', // è¾“å‡ºæ–‡ä»¶å
    path: path.join(__dirname, 'dist'), // è¾“å‡ºæ–‡ä»¶ç›®å½•
  },
  module: { 
    rules: [
      {
        test: /\.js$/i,
        use: [
          {
            loader: 'babel-loader',
            options: {
              presets: [
                '@babel/preset-env'
              ],
            }
          }
        ]
      },
    // ...
    ]
  },
  //...
}
// ...

```

é…ç½®å®Œæˆä¹‹åæ‰§è¡Œä¸€ä¸‹æ‰“åŒ…
![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/150bfa173e2640969731294876d75a22~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

åˆšæ‰å†™çš„ ES6 class å†™æ³• å·²ç»è½¬æ¢ä¸ºäº† ES5 çš„æ„é€ å‡½æ•°å½¢å¼

å°½ç„¶æ˜¯åšå…¼å®¹å¤„ç†ï¼Œæˆ‘ä»¬è‡ªç„¶ä¹Ÿå¯ä»¥æŒ‡å®šåˆ°åº•è¦å…¼å®¹å“ªäº›æµè§ˆå™¨

ä¸ºäº†é¿å… webpack.config.js å¤ªè‡ƒè‚¿ï¼Œå»ºè®®å°† Babel é…ç½®æ–‡ä»¶æå–å‡ºæ¥

æ ¹ç›®å½•ä¸‹æ–°å¢ .babelrc.js

```js
// ./babelrc.js

module.exports = {
  presets: [
    [
      "@babel/preset-env",
      {
        // useBuiltIns: false é»˜è®¤å€¼ï¼Œæ— è§†æµè§ˆå™¨å…¼å®¹é…ç½®ï¼Œå¼•å…¥æ‰€æœ‰ polyfill
        // useBuiltIns: entry æ ¹æ®é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œå¼•å…¥æµè§ˆå™¨ä¸å…¼å®¹çš„ polyfill
        // useBuiltIns: usage ä¼šæ ¹æ®é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œä»¥åŠä½ ä»£ç ä¸­ç”¨åˆ°çš„ API æ¥è¿›è¡ŒÂ polyfillï¼Œå®ç°äº†æŒ‰éœ€æ·»åŠ 
        useBuiltIns: "entry",
        corejs: "3.9.1", // æ˜¯ core-js ç‰ˆæœ¬å·
        targets: {
          chrome: "58",
          ie: "11",
        },
      },
    ],
  ],
};


```

å¥½äº†ï¼Œè¿™é‡Œä¸€ä¸ªç®€å•çš„ Babel é¢„è®¾å°±é…ç½®å®Œäº†

å¸¸è§ Babel é¢„è®¾è¿˜æœ‰ï¼š
@babel/preset-flow
@babel/preset-react
@babel/preset-typescript

4. é…ç½® Babel æ’ä»¶
å¯¹äºæ­£åœ¨ææ¡ˆä¸­ï¼Œè¿˜æœªè¿›å…¥ ECMA è§„èŒƒä¸­çš„æ–°ç‰¹æ€§ï¼ŒBabel æ˜¯æ— æ³•è¿›è¡Œå¤„ç†çš„ï¼Œå¿…é¡»è¦å®‰è£…å¯¹åº”çš„æ’ä»¶ï¼Œä¾‹å¦‚ï¼š

```js
// ./ index.js

import './main.css';
import './sass.scss'
import logo from '../public/avatar.png'

import './fonts/iconfont.css'

const a = 'Hello ITEM'
console.log(a)

const img = new Image()
img.src = logo

document.getElementById('imgBox').appendChild(img)

// æ–°å¢è£…é¥°å™¨çš„ä½¿ç”¨
@log('hi')
class MyClass { }

function log(text) {
  return function(target) {
    target.prototype.logger = () => `${text}ï¼Œ${target.name}`
  }
}

const test = new MyClass()
test.logger()

```